# Makefile pour l'application BingX Trading

.PHONY: help install test clean run-examples

# Variables
PYTHON = python
MODULE = bingxapp

help: ## Affiche cette aide
	@echo "ğŸš€ Application BingX Trading - Commandes disponibles:"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

install: ## Installe l'application et ses dÃ©pendances
	@echo "ğŸ“¦ Installation de l'application BingX..."
	$(PYTHON) -m pip install -r requirements.txt
	@echo "âœ… Installation terminÃ©e"

test: ## Teste la connexion Ã  BingX
	@echo "ğŸ§ª Test de connexion Ã  BingX..."
	cd .. && $(PYTHON) -m $(MODULE).main test

test-full: ## ExÃ©cute tous les tests
	@echo "ğŸ§ª Tests complets..."
	cd .. && $(PYTHON) $(MODULE)/test_app.py

market: ## RÃ©cupÃ¨re les donnÃ©es de marchÃ© pour BTC-USDT
	@echo "ğŸ“Š DonnÃ©es de marchÃ© BTC-USDT..."
	cd .. && $(PYTHON) -m $(MODULE).main market BTC-USDT

positions: ## Affiche les positions ouvertes
	@echo "ğŸ“‹ Positions ouvertes..."
	cd .. && $(PYTHON) -m $(MODULE).main positions

examples: ## Lance les exemples interactifs
	@echo "ğŸ“š Exemples d'utilisation..."
	cd .. && $(PYTHON) -m $(MODULE).examples

monitor: ## DÃ©marre le monitoring (BTC-USDT et ETH-USDT)
	@echo "ğŸ‘€ Monitoring BTC-USDT et ETH-USDT..."
	@echo "ğŸ›‘ Appuyez sur Ctrl+C pour arrÃªter"
	cd .. && $(PYTHON) -m $(MODULE).main monitor BTC-USDT ETH-USDT

monitor-btc: ## DÃ©marre le monitoring pour BTC-USDT uniquement
	@echo "ğŸ‘€ Monitoring BTC-USDT..."
	@echo "ğŸ›‘ Appuyez sur Ctrl+C pour arrÃªter"
	cd .. && $(PYTHON) -m $(MODULE).main monitor BTC-USDT

clean: ## Nettoie les fichiers temporaires
	@echo "ğŸ§¹ Nettoyage..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	@echo "âœ… Nettoyage terminÃ©"

info: ## Affiche les informations du compte
	@echo "ğŸ’° Informations du compte..."
	cd .. && $(PYTHON) -c "from $(MODULE).examples import exemple_informations_compte; exemple_informations_compte()"

analyze: ## Analyse les positions ouvertes
	@echo "ğŸ“Š Analyse des positions..."
	cd .. && $(PYTHON) -c "from $(MODULE).examples import exemple_analyse_positions; exemple_analyse_positions()"

orderbook: ## Affiche le carnet d'ordres BTC-USDT
	@echo "ğŸ“– Carnet d'ordres BTC-USDT..."
	cd .. && $(PYTHON) -c "from $(MODULE).examples import exemple_carnet_ordres; exemple_carnet_ordres()"

# Commandes avancÃ©es
setup: ## Configuration initiale complÃ¨te
	@echo "ğŸ”§ Configuration initiale..."
	$(PYTHON) $(MODULE)/setup.py

dev-install: ## Installation pour le dÃ©veloppement
	@echo "ğŸ› ï¸  Installation dÃ©veloppement..."
	$(PYTHON) -m pip install -r requirements.txt
	$(PYTHON) -m pip install -e .

# Commandes de trading (attention !)
order-market: ## Place un ordre au marchÃ© (exemple: make order-market SYMBOL=BTC-USDT SIDE=BUY QTY=0.001)
	@echo "âš ï¸  Placement d'un ordre au marchÃ©..."
	@echo "Symbole: $(SYMBOL), CÃ´tÃ©: $(SIDE), QuantitÃ©: $(QTY)"
	@read -p "ÃŠtes-vous sÃ»r ? (y/N): " confirm && [ "$$confirm" = "y" ] || exit 1
	$(PYTHON) -m $(MODULE).main order $(SYMBOL) $(SIDE) MARKET $(QTY)

order-limit: ## Place un ordre limite (exemple: make order-limit SYMBOL=BTC-USDT SIDE=BUY QTY=0.001 PRICE=50000)
	@echo "âš ï¸  Placement d'un ordre limite..."
	@echo "Symbole: $(SYMBOL), CÃ´tÃ©: $(SIDE), QuantitÃ©: $(QTY), Prix: $(PRICE)"
	@read -p "ÃŠtes-vous sÃ»r ? (y/N): " confirm && [ "$$confirm" = "y" ] || exit 1
	$(PYTHON) -m $(MODULE).main order $(SYMBOL) $(SIDE) LIMIT $(QTY) --price $(PRICE)

# Aide dÃ©taillÃ©e
help-trading: ## Aide pour les commandes de trading
	@echo "âš ï¸  COMMANDES DE TRADING - UTILISEZ AVEC PRÃ‰CAUTION !"
	@echo ""
	@echo "ğŸ“ Ordre au marchÃ©:"
	@echo "   make order-market SYMBOL=BTC-USDT SIDE=BUY QTY=0.001"
	@echo ""
	@echo "ğŸ“ Ordre limite:"
	@echo "   make order-limit SYMBOL=BTC-USDT SIDE=BUY QTY=0.001 PRICE=50000"
	@echo ""
	@echo "âš ï¸  Ces commandes placent de vrais ordres sur votre compte !"

help-examples: ## Aide pour les exemples
	@echo "ğŸ“š EXEMPLES DISPONIBLES:"
	@echo ""
	@echo "ğŸ”¸ make info      - Informations du compte"
	@echo "ğŸ”¸ make analyze   - Analyse des positions"
	@echo "ğŸ”¸ make orderbook - Carnet d'ordres"
	@echo "ğŸ”¸ make examples  - Exemples interactifs"
